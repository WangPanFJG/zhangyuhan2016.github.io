<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>扫码</title>
    <style>
        body{
            background-color: #e7e8eb;
            text-align: center;
            color: #777979;
        }
        input,button{
            width: 150px;
            height: 40px;
            background-color: inherit;
            border: 1px solid #cccccc;
            text-align: center;
            outline: none;
            transition: all 0.6s;
        }
        button{
            margin-top: 10px;
            background-color: #f4f5f9;
        }
        h4{

        }
        input[type='password']{
            margin-top: 50px;
        }
        input[type='text']{
            position: absolute;
            border: 0;
            font-size: 1.2rem;
            color: #03a9f4;
        }
        button[name='login']{
            display: none;
        }
        .close-tip{
            display: none;
            text-align: center;
            height: 300px;
            line-height: 100px;
        }
        .p-t-50{
            padding-top: 50px;
        }
    </style>
</head>
<body>
    <div class="close-tip">
        <h1>3</h1>
        <h3>操作成功,即将关闭页面</h3>
    </div>
    <div class="p-t-50">
        <h3>您正在扫码登录</h3>
        <input type="text" value="zhangyuhan" disabled="disabled">
        <input type="password" placeholder="请输入您的密码">
        <br>
        <button name="login">授权登录</button>
        <button name="reset">这不是我</button>
    </div>


<script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script>
    "use strict"
    var flag = true
    /*获取数据,消灭证据*/

    function start(){
        try{
            var obj = JSON.parse(decodeURI(window.location.href.split("?data=")[1]))
        }catch (err){
            flag = false
        }
        console.info(obj)
//        window.history.pushState("", "page 3", "/扫码登录");
    }
    start()
    /*输入密码时*/
    $("input[type='password']").on("keyup",function () {
        if($(this).val().trim()){
            $("button[name='reset']").slideUp(200)
            $("button[name='login']").slideDown(500)
        }else{
            $("button[name='login']").slideUp(200)
            $("button[name='reset']").slideDown(500)
        }
    })
    /*管理员授权登录*/
    $("button[name='login']").on('click',function () {

    })
    /*其他用户登录输入用户名*/
    $("button[name='reset']").on('click',function () {
        $("input[type='text']").css({
            'margin-top':'50px',
            'border':'1px solid #cccccc',
            'background-color': 'white'
        })
        $(this).text("登录").attr("name","userLogin")
        $("input[type='text']").removeAttr("disabled").focus()
        setTimeout(function () {
            delVal()
        },1000)
        $(this).off().on('click',function () {
            console.log($("input[type='text']").val())
            closeWindows()
        })
    })
    /*删除用户名*/
    function delVal(){
        var a = $("input[type='text']").val()
        if(a.length !==0){
            $("input[type='text']").val(a.slice(0,-1))
            setTimeout(function () {
                delVal()
            },100)
        }
    }
    /*倒计时*/
    function timeClose(callback){
        var t = parseInt($(".close-tip h1").text())
        t--
        if(t === 0){
            return callback()
        }
        $(".close-tip h1").text(t)
        setTimeout(function () {
            timeClose(callback)
        },1000)
    }
    /*关闭页面*/
    function closeView () {
        window.close();
        WeixinJSBridge.call('closeWindow');
    }
    /*操作成功关闭页面*/
    function closeWindows(){
        $(".close-tip").slideDown(500).siblings("div").slideUp(300)
        timeClose(closeView)
    }
</script>
</body>
</html>